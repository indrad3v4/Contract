{% extends "base.html" %}

{% block title %}Daodiseo - Real Estate Tokenization Dashboard{% endblock %}

{% block extra_css %}
<!-- Enhanced Chat CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/chat-enhanced.css') }}">
<!-- Enhanced Dashboard CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard-enhanced.css') }}">
{% endblock %}

{% block content %}
<div class="daodiseo-brain-dashboard">
    <!-- DAODISEO AI BRAIN Central Hub -->
    <div class="row justify-content-center mb-5">
        <div class="col-12 col-lg-8 text-center">
            <div class="brain-central-hub">
                <div class="brain-visualization">
                    <div class="brain-core">
                        <div class="brain-icon">
                            <i data-feather="cpu" class="brain-processor"></i>
                        </div>
                        <div class="brain-pulse"></div>
                    </div>
                    <h2 class="brain-title dds-text-primary">DAODISEO AI BRAIN</h2>
                    <p class="brain-subtitle dds-text-secondary">LLM trained on BIM and RWA data - Provides predictive insights and human-like interactions</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Architecture Quadrants around AI Brain -->
    <div class="row g-4">
        <!-- DAODAO Quadrant (Top Left) -->
        <div class="col-lg-6">
            <div class="architecture-quadrant daodao-section">
                <div class="dds-card">
                    <div class="dds-card-header">
                        <h3 class="dds-card-title dds-text-primary">
                            <i data-feather="users" class="dds-icon-md me-2"></i>
                            DAODAO Governance
                        </h3>
                        <p class="dds-text-secondary">DAO organizational structure & voting system</p>
                    </div>
                    <div class="dds-card-body">
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="dds-metric-card text-center">
                                    <div class="dds-metric-value dds-text-primary" id="total-reserves">$38,126.50</div>
                                    <div class="dds-metric-label">Total Portfolio Value</div>
                                    <div class="dds-status-badge dds-status-success mt-2">
                                        <i data-feather="check-circle" class="dds-icon-sm me-1"></i>
                                        DAO Verified
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="dds-metric-card text-center">
                                    <div class="dds-metric-value dds-text-warning" id="active-proposals">12</div>
                                    <div class="dds-metric-label">Active Proposals</div>
                                    <div class="dds-status-badge dds-status-warning mt-2">
                                        <i data-feather="vote" class="dds-icon-sm me-1"></i>
                                        Voting Active
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="governance-chart mt-4">
                            <canvas id="stakeholder-chart" class="mb-3"></canvas>
                            <div class="dds-chart-legend">
                                <div class="dds-legend-item">
                                    <div class="dds-legend-color dds-bg-primary"></div>
                                    <span class="dds-text-white">Institutional (45%)</span>
                                </div>
                                <div class="dds-legend-item">
                                    <div class="dds-legend-color dds-bg-success"></div>
                                    <span class="dds-text-white">Private (25%)</span>
                                </div>
                                <div class="dds-legend-item">
                                    <div class="dds-legend-color dds-bg-warning"></div>
                                    <span class="dds-text-white">Developer (20%)</span>
                                </div>
                                <div class="dds-legend-item">
                                    <div class="dds-legend-color dds-bg-danger"></div>
                                    <span class="dds-text-white">Reserved (10%)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DAODISEO.app Quadrant (Top Right) -->
        <div class="col-lg-6">
            <div class="architecture-quadrant daodiseo-app-section">
                <div class="dds-card">
                    <div class="dds-card-header">
                        <h3 class="dds-card-title dds-text-primary">
                            <i data-feather="upload" class="dds-icon-md me-2"></i>
                            DAODISEO.app Interface
                        </h3>
                        <p class="dds-text-secondary">IFC + IPES file upload & smart budget split</p>
                    </div>
                    <div class="dds-card-body">
                        <div class="hot-asset-showcase">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="dds-text-white">Hot Asset Seeking Liquidity</h5>
                                <div class="dds-status-badge dds-status-success">
                                    <i data-feather="shield" class="dds-icon-sm me-1"></i>
                                    VERIFIED
                                </div>
                            </div>
                            <div id="mini-viewer-container" class="dds-bim-viewer-mini mb-3"></div>
                            <div class="asset-details">
                                <h6 class="dds-text-white mb-2">Ithaca Project</h6>
                                <div class="row g-2">
                                    <div class="col-4 text-center">
                                        <i data-feather="layers" class="dds-icon-sm dds-text-secondary mb-1"></i>
                                        <div class="dds-text-secondary small">Due Diligence</div>
                                        <div class="dds-text-white">3 years</div>
                                    </div>
                                    <div class="col-4 text-center">
                                        <i data-feather="check-circle" class="dds-icon-sm dds-text-success mb-1"></i>
                                        <div class="dds-text-secondary small">Status</div>
                                        <div class="dds-text-success">SPV Verified</div>
                                    </div>
                                    <div class="col-4 text-center">
                                        <i data-feather="shield" class="dds-icon-sm dds-text-primary mb-1"></i>
                                        <div class="dds-text-secondary small">Type</div>
                                        <div class="dds-text-primary">Hard Asset</div>
                                    </div>
                                </div>
                            </div>
                            <div class="funding-progress mt-3">
                                <div class="dds-progress">
                                    <div class="dds-progress-bar dds-bg-primary" style="width: 65%;" role="progressbar"></div>
                                </div>
                                <div class="d-flex justify-content-between mt-2">
                                    <span class="dds-text-success">Funded: $1,625,000</span>
                                    <span class="dds-text-secondary">Target: $2,500,000</span>
                                </div>
                            </div>
                            <button class="dds-btn dds-btn-primary w-100 mt-3" data-bs-toggle="modal" data-bs-target="#investModal">
                                <i data-feather="dollar-sign" class="dds-icon-sm me-2"></i>
                                Invest in Asset
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Row: Ping.pub and Cosmos SDK -->
    <div class="row g-4 mt-2">
        <!-- Ping.pub Quadrant (Bottom Left) -->
        <div class="col-lg-6">
            <div class="architecture-quadrant pingpub-section">
                <div class="dds-card">
                    <div class="dds-card-header">
                        <h3 class="dds-card-title dds-text-primary">
                            <i data-feather="shield" class="dds-icon-md me-2"></i>
                            Ping.pub Validators
                        </h3>
                        <p class="dds-text-secondary">Validator explorer & chain status control</p>
                    </div>
                    <div class="dds-card-body">
                        <div class="validator-overview">
                            <div class="row g-3 mb-4">
                                <div class="col-6">
                                    <div class="dds-metric-card text-center">
                                        <div class="dds-metric-value dds-text-success" id="active-validators-count">10</div>
                                        <div class="dds-metric-label">Active Validators</div>
                                        <div class="dds-status-badge dds-status-success mt-1">
                                            <i data-feather="check" class="dds-icon-sm me-1"></i>
                                            Online
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="dds-metric-card text-center">
                                        <div class="dds-metric-value dds-text-primary" id="total-voting-power">100M</div>
                                        <div class="dds-metric-label">Total Voting Power</div>
                                        <div class="dds-status-badge dds-status-primary mt-1">
                                            <i data-feather="zap" class="dds-icon-sm me-1"></i>
                                            Securing Network
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="staking-metrics">
                                <div class="row g-2">
                                    <div class="col-3">
                                        <div class="dds-metric-item text-center">
                                            <div class="dds-metric-value dds-text-white" id="staking-apy">9.5%</div>
                                            <div class="dds-metric-label">Staking APY</div>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="dds-metric-item text-center">
                                            <div class="dds-metric-value dds-text-white" id="staking-ratio">Loading...</div>
                                            <div class="dds-metric-label">Staking Ratio</div>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="dds-metric-item text-center">
                                            <div class="dds-metric-value dds-text-white" id="avg-block-time">6.5s</div>
                                            <div class="dds-metric-label">Block Time</div>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="dds-metric-item text-center">
                                            <div class="dds-metric-value dds-text-white" id="inflation-rate">7.2%</div>
                                            <div class="dds-metric-label">Inflation</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cosmos SDK Modules Quadrant (Bottom Right) -->
        <div class="col-lg-6">
            <div class="architecture-quadrant cosmos-sdk-section">
                <div class="dds-card">
                    <div class="dds-card-header">
                        <h3 class="dds-card-title dds-text-primary">
                            <i data-feather="link" class="dds-icon-md me-2"></i>
                            Cosmos SDK Modules
                        </h3>
                        <p class="dds-text-secondary">BIM sync engine & chain status control</p>
                    </div>
                    <div class="dds-card-body">
                        <div class="transactions-overview">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="dds-text-white">Recent Transactions</h5>
                                <a href="/contracts" class="dds-btn dds-btn-primary btn-sm">View All</a>
                            </div>
                            <div class="transaction-list">
                                <div class="transaction-item d-flex align-items-center mb-3">
                                    <div class="transaction-icon me-3">
                                        <i data-feather="check-circle" class="dds-icon-sm dds-text-success"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="transaction-title dds-text-white">Property Tokenization</div>
                                        <div class="transaction-meta dds-text-secondary">0x71C...9E3f • 2 hours ago</div>
                                    </div>
                                    <div class="transaction-value dds-text-success">+1250 ODIS</div>
                                </div>
                                <div class="transaction-item d-flex align-items-center mb-3">
                                    <div class="transaction-icon me-3">
                                        <i data-feather="file-text" class="dds-icon-sm dds-text-warning"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="transaction-title dds-text-white">Contract Signature</div>
                                        <div class="transaction-meta dds-text-secondary">0x31F...7A2c • 5 hours ago</div>
                                    </div>
                                    <div class="transaction-value dds-text-warning">Pending</div>
                                </div>
                                <div class="transaction-item d-flex align-items-center">
                                    <div class="transaction-icon me-3">
                                        <i data-feather="refresh-cw" class="dds-icon-sm dds-text-primary"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="transaction-title dds-text-white">Token Transfer</div>
                                        <div class="transaction-meta dds-text-secondary">0x94B...2D5a • 1 day ago</div>
                                    </div>
                                    <div class="transaction-value dds-text-primary">-350 ODIS</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ODIS Token Status Bar -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="dds-card odis-status-bar">
                <div class="dds-card-body">
                    <div class="row g-3 align-items-center">
                        <div class="col-auto">
                            <div class="dds-token-badge">
                                <span class="dds-text-white fw-bold">ODIS</span>
                            </div>
                        </div>
                        <div class="col">
                            <div class="row g-3">
                                <div class="col-6 col-md-2">
                                    <div class="dds-metric-item text-center">
                                        <div class="dds-metric-value dds-text-primary" id="odis-price">$0.1214</div>
                                        <div class="dds-metric-change dds-text-success">
                                            <i data-feather="trending-up" class="dds-icon-sm me-1"></i>
                                            <span id="odis-change">+3.68%</span>
                                        </div>
                                        <div class="dds-metric-label">Current Price</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-2">
                                    <div class="dds-metric-item text-center">
                                        <div class="dds-metric-value dds-text-white" id="market-cap">$12.4M</div>
                                        <div class="dds-metric-label">Market Cap</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-2">
                                    <div class="dds-metric-item text-center">
                                        <div class="dds-metric-value dds-text-white" id="volume-24h">$2.5M</div>
                                        <div class="dds-metric-label">Volume (24h)</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-2">
                                    <div class="dds-metric-item text-center">
                                        <div class="dds-metric-value dds-text-success" id="high-24h">$0.1289</div>
                                        <div class="dds-metric-label">24h High</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-2">
                                    <div class="dds-metric-item text-center">
                                        <div class="dds-metric-value dds-text-warning" id="low-24h">$0.1156</div>
                                        <div class="dds-metric-label">24h Low</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-2">
                                    <div class="dds-metric-item text-center">
                                        <div class="dds-metric-value dds-text-primary" id="daily-rewards">0.318</div>
                                        <div class="dds-metric-label">Daily Rewards</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-auto">
                            <button class="dds-btn dds-btn-primary">
                                <i data-feather="shopping-cart" class="dds-icon-sm me-2"></i>
                                Buy ODIS
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
                <div class="dds-card-body">
                    <div class="row g-3">
                        <div class="col-lg-8">
                            <div class="row g-3">
                                <div class="col-6 col-md-3">
                                    <div class="dds-metric-item">
                                        <div class="dds-metric-value dds-text-primary" id="odis-price">$0.1214</div>
                                        <div class="dds-metric-change dds-text-success">
                                            <i data-feather="trending-up" class="dds-icon-sm me-1"></i>
                                            <span id="odis-change">+3.68%</span>
                                        </div>
                                        <div class="dds-metric-label">Current Price</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="dds-metric-item">
                                        <div class="dds-metric-value dds-text-white" id="market-cap">$12.4M</div>
                                        <div class="dds-metric-label">Market Cap</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="dds-metric-item">
                                        <div class="dds-metric-value dds-text-white" id="volume-24h">$2.5M</div>
                                        <div class="dds-metric-label">Volume (24h)</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="dds-metric-item">
                                        <div class="dds-metric-value dds-text-primary" id="staking-apy">9.5%</div>
                                        <div class="dds-metric-label">Staking APY</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="dds-metric-item">
                                        <div class="dds-metric-value dds-text-success" id="high-24h">$0.1289</div>
                                        <div class="dds-metric-label">24h High</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="dds-metric-item">
                                        <div class="dds-metric-value dds-text-warning" id="low-24h">$0.1156</div>
                                        <div class="dds-metric-label">24h Low</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="dds-chart-container">
                                <div class="dds-chart-placeholder text-center py-4">
                                    <i data-feather="trending-up" class="dds-icon-xl dds-text-secondary mb-2"></i>
                                    <div class="dds-text-white">Live Price Chart</div>
                                    <small class="dds-text-secondary">Real-time ODIS price data</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Portfolio Overview Cards -->
    <div class="row g-4 mb-4">
        <div class="col-12 col-md-6 col-xl-3">
            <div class="dds-card dds-card-hover">
                <div class="dds-card-body text-center">
                    <div class="dds-metric-value dds-text-primary" id="total-reserves">$38,126.50</div>
                    <div class="dds-metric-label">Total Portfolio Value</div>
                    <div class="dds-metric-description">Combined value of all your real estate investments</div>
                    <div class="dds-status-badge dds-status-success mt-2">
                        <i data-feather="check-circle" class="dds-icon-sm me-1"></i>
                        Verified
                    </div>
                    <div class="dds-card-icon dds-text-primary">
                        <i data-feather="trending-up" class="dds-icon-lg"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6 col-xl-3">
            <div class="dds-card dds-card-hover">
                <div class="dds-card-body text-center">
                    <div class="dds-metric-value dds-text-success" id="verified-assets">$2.1M</div>
                    <div class="dds-metric-label">Real Estate Assets</div>
                    <div class="dds-metric-description">Property value verified through blockchain due diligence</div>
                    <div class="dds-status-badge dds-status-success mt-2">
                        <i data-feather="shield" class="dds-icon-sm me-1"></i>
                        Due Diligence Complete
                    </div>
                    <div class="dds-card-icon dds-text-success">
                        <i data-feather="check-circle" class="dds-icon-lg"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6 col-xl-3">
            <div class="dds-card dds-card-hover">
                <div class="dds-card-body text-center">
                    <div class="dds-metric-value dds-text-warning" id="active-contracts">12</div>
                    <div class="dds-metric-label">Smart Contracts</div>
                    <div class="dds-metric-description">Active tokenization contracts processing transactions</div>
                    <div class="dds-status-badge dds-status-warning mt-2">
                        <i data-feather="clock" class="dds-icon-sm me-1"></i>
                        Processing
                    </div>
                    <div class="dds-card-icon dds-text-warning">
                        <i data-feather="file-text" class="dds-icon-lg"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6 col-xl-3">
            <div class="dds-card dds-card-hover">
                <div class="dds-card-body text-center">
                    <div class="dds-metric-value dds-text-primary" id="daily-rewards">0.318</div>
                    <div class="dds-metric-label">Staking Rewards (24h)</div>
                    <div class="dds-metric-description">ODIS tokens earned from network participation</div>
                    <div class="dds-status-badge dds-status-primary mt-2">
                        <i data-feather="repeat" class="dds-icon-sm me-1"></i>
                        Auto-Compounding
                    </div>
                    <div class="dds-card-icon dds-text-primary">
                        <i data-feather="award" class="dds-icon-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Asset Distribution Panel -->
        <div class="col-lg-5">
            <div class="dds-card mb-4">
                <div class="dds-card-header d-flex justify-content-between align-items-start">
                    <div>
                        <h3 class="dds-card-title dds-text-white mb-1">
                            <i data-feather="pie-chart" class="dds-icon-md me-2"></i>
                            Portfolio Distribution
                        </h3>
                        <div class="dds-text-secondary">Real estate asset verification status</div>
                    </div>
                    <div class="dds-help-icon">
                        <i data-feather="help-circle" class="dds-icon-sm dds-text-secondary"></i>
                    </div>
                </div>
                <div class="dds-card-body">
                    <div class="dds-chart-container">
                        <canvas id="asset-distribution-chart" class="mb-3"></canvas>
                        <div class="dds-chart-legend">
                            <div class="dds-legend-item">
                                <div class="dds-legend-color dds-bg-success"></div>
                                <span class="dds-text-white">Verified Properties</span>
                            </div>
                            <div class="dds-legend-item">
                                <div class="dds-legend-color dds-bg-warning"></div>
                                <span class="dds-text-white">In Due Diligence</span>
                            </div>
                        </div>
                    </div>
                    <div class="row g-3 mt-3">
                        <div class="col-6">
                            <div class="dds-metric-card text-center">
                                <div class="dds-metric-value dds-text-success">$24.25M</div>
                                <div class="dds-metric-label">Verified Properties</div>
                                <div class="dds-metric-description">Ready for tokenization and trading</div>
                                <div class="dds-status-badge dds-status-success mt-2">
                                    <i data-feather="check" class="dds-icon-sm me-1"></i>
                                    Investment Ready
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="dds-metric-card text-center">
                                <div class="dds-metric-value dds-text-warning">$13.88M</div>
                                <div class="dds-metric-label">Under Review</div>
                                <div class="dds-metric-description">Completing verification process</div>
                                <div class="dds-status-badge dds-status-warning mt-2">
                                    <i data-feather="clock" class="dds-icon-sm me-1"></i>
                                    Processing
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Assistant Panel -->
            <div class="dds-card">
                <div class="dds-card-header">
                    <h5 class="dds-card-title dds-text-white mb-1">
                        <i data-feather="message-circle" class="dds-icon-md me-2"></i>
                        BIM AI Assistant
                    </h5>
                    <div class="dds-text-secondary">Stakeholder-aware building insights</div>
                </div>
                <div class="dds-card-body">
                    <div id="ai-chat-container" class="dds-chat-container"></div>
                </div>
            </div>
        </div>

        <!-- Hot Asset Panel -->
        <div class="col-lg-7">
            <div class="dds-card">
                <div class="dds-card-header d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="dds-card-title dds-text-white mb-1">
                            <i data-feather="zap" class="dds-icon-md me-2 dds-text-primary"></i>
                            Hot Asset Seeking Liquidity
                        </h5>
                        <div class="dds-text-secondary">Verified Asset with Due Diligence Complete</div>
                    </div>
                    <div class="dds-status-badge dds-status-success">
                        <i data-feather="shield" class="dds-icon-sm me-1"></i>
                        VERIFIED
                    </div>
                </div>
                <div class="dds-card-body p-0">
                    <div id="mini-viewer-container" class="dds-bim-viewer-mini"></div>
                </div>
                <div class="dds-card-footer">
                    <div class="row g-3 align-items-center">
                        <div class="col-lg-8">
                            <div class="dds-asset-info">
                                <h6 class="dds-text-white mb-2">Ithaca Project</h6>
                                <div class="row g-2">
                                    <div class="col-4">
                                        <div class="dds-meta-item text-center">
                                            <i data-feather="layers" class="dds-icon-sm dds-text-secondary mb-1"></i>
                                            <div class="dds-text-secondary small">Due Diligence</div>
                                            <div class="dds-text-white">3 years</div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="dds-meta-item text-center">
                                            <i data-feather="check-circle" class="dds-icon-sm dds-text-success mb-1"></i>
                                            <div class="dds-text-secondary small">Status</div>
                                            <div class="dds-text-success">SPV Verified</div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="dds-meta-item text-center">
                                            <i data-feather="shield" class="dds-icon-sm dds-text-primary mb-1"></i>
                                            <div class="dds-text-secondary small">Type</div>
                                            <div class="dds-text-primary">Hard Asset</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 text-center">
                            <button class="dds-btn dds-btn-primary w-100" data-bs-toggle="modal" data-bs-target="#investModal">
                                <i data-feather="dollar-sign" class="dds-icon-sm me-2"></i>
                                Invest Now
                            </button>
                        </div>
                    </div>

                    <div class="dds-progress-container mt-3">
                        <div class="dds-progress">
                            <div class="dds-progress-bar dds-bg-primary" style="width: 65%;" role="progressbar" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <div class="d-flex justify-content-between mt-2">
                            <span class="dds-text-success">Funded: $1,625,000</span>
                            <span class="dds-text-secondary">Target: $2,500,000</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mt-4">
        <!-- Recent Transactions Panel -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">
                        <i data-feather="list" class="icon-inline"></i>
                        Recent Transactions
                    </h5>
                    <div class="card-actions">
                        <a href="/contracts" class="btn btn-sm btn-outline-info">
                            View All
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="transaction-list">
                        <div class="transaction-item">
                            <div class="transaction-icon success">
                                <i data-feather="check-circle"></i>
                            </div>
                            <div class="transaction-details">
                                <div class="transaction-title">Property Tokenization <span class="badge bg-success">VERIFIED</span></div>
                                <div class="transaction-meta">
                                    <span class="transaction-address">0x71C...9E3f</span>
                                    <span class="transaction-time">2 hours ago</span>
                                </div>
                            </div>
                            <div class="transaction-value success">+1250 ODIS</div>
                        </div>
                        <div class="transaction-item">
                            <div class="transaction-icon info">
                                <i data-feather="file-text"></i>
                            </div>
                            <div class="transaction-details">
                                <div class="transaction-title">Contract Signature <span class="badge bg-warning">PENDING</span></div>
                                <div class="transaction-meta">
                                    <span class="transaction-address">0x31F...7A2c</span>
                                    <span class="transaction-time">5 hours ago</span>
                                </div>
                            </div>
                            <div class="transaction-value">0 ODIS</div>
                        </div>
                        <div class="transaction-item">
                            <div class="transaction-icon warning">
                                <i data-feather="refresh-cw"></i>
                            </div>
                            <div class="transaction-details">
                                <div class="transaction-title">Token Transfer <span class="badge bg-success">VERIFIED</span></div>
                                <div class="transaction-meta">
                                    <span class="transaction-address">0x94B...2D5a</span>
                                    <span class="transaction-time">1 day ago</span>
                                </div>
                            </div>
                            <div class="transaction-value warning">-350 ODIS</div>
                        </div>
                        <div class="transaction-item">
                            <div class="transaction-icon secondary">
                                <i data-feather="upload"></i>
                            </div>
                            <div class="transaction-details">
                                <div class="transaction-title">Document Upload <span class="badge bg-warning">UNVERIFIED</span></div>
                                <div class="transaction-meta">
                                    <span class="transaction-address">0x67D...3F1b</span>
                                    <span class="transaction-time">2 days ago</span>
                                </div>
                            </div>
                            <div class="transaction-value">0 ODIS</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stakeholder Distribution Chart -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">
                        <i data-feather="users" class="icon-inline"></i>
                        Stakeholder Distribution
                    </h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="stakeholder-chart"></canvas>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <!-- Network Validators Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card validators-overview">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="mb-0">
                            <i data-feather="shield" class="icon-inline me-2"></i>
                            Active Validators
                        </h5>
                        <small class="text-muted">Odiseo Network Validation Nodes</small>
                    </div>
                    <div class="validators-stats">
                        <span class="badge bg-success me-2">
                            <span id="active-validators-count">10</span> Active
                        </span>
                        <span class="badge bg-info">
                            <span id="total-voting-power">100M</span> Total Power
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row" id="validators-grid">
                        <!-- Validators will be populated by JavaScript -->
                        <div class="col-md-4 mb-3">
                            <div class="validator-card">
                                <div class="validator-header d-flex align-items-center mb-2">
                                    <div class="validator-avatar me-3">
                                        <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                            <i data-feather="user" style="width: 16px; height: 16px;"></i>
                                        </div>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="validator-name">Loading...</div>
                                        <div class="validator-status">
                                            <span class="status-indicator active"></span>
                                            <span class="status-text">Active</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="validator-metrics">
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="metric-small">
                                                <div class="metric-value">--</div>
                                                <div class="metric-label">Voting Power</div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="metric-small">
                                                <div class="metric-value">--</div>
                                                <div class="metric-label">Commission</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="validator-actions mt-2">
                                    <button class="btn btn-sm btn-outline-primary me-2" disabled>
                                        <i data-feather="trending-up" class="icon-inline-sm"></i>
                                        Delegate
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" disabled>
                                        <i data-feather="info" class="icon-inline-sm"></i>
                                        Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="staking-overview mt-4 pt-3 border-top">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="staking-metric">
                                    <div class="metric-value" id="total-staked">Loading...</div>
                                    <div class="metric-label">Total Staked</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="staking-metric">
                                    <div class="metric-value" id="staking-ratio">Loading...</div>
                                    <div class="metric-label">Staking Ratio</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="staking-metric">
                                    <div class="metric-value" id="avg-block-time">6.5s</div>
                                    <div class="metric-label">Block Time</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="staking-metric">
                                    <div class="metric-value" id="inflation-rate">7.2%</div>
                                    <div class="metric-label">Inflation</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Investment Modal -->
<div class="modal fade" id="investModal" tabindex="-1" aria-labelledby="investModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-light border-info">
            <div class="modal-header border-info">
                <h5 class="modal-title" id="investModalLabel">
                    <i data-feather="dollar-sign" class="icon-inline text-info"></i>
                    Invest in Ithaca Project
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="investmentAmount" class="form-label">Investment Amount (ODIS)</label>
                    <input type="number" class="form-control bg-dark text-light border-info" id="investmentAmount" placeholder="Enter amount">
                </div>
                <div class="mb-3">
                    <label for="walletAddress" class="form-label">Wallet Address</label>
                    <div class="input-group">
                        <input type="text" class="form-control bg-dark text-light border-info" id="walletAddress" value="0x71C...9E3f" readonly>
                        <button class="btn btn-outline-info" type="button">
                            <i data-feather="copy" class="icon-inline-sm"></i>
                        </button>
                    </div>
                </div>
                <div class="alert alert-info">
                    <i data-feather="info" class="icon-inline-sm"></i>
                    This investment will be automatically staked, earning 9.5% APY.
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="spvKycCheck">
                    <label class="form-check-label" for="spvKycCheck">
                        I confirm this asset has passed SPV/KYC verification
                    </label>
                </div>
            </div>
            <div class="modal-footer border-info">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-info" id="investModalConnectBtn">
                    <i data-feather="link" class="icon-inline-sm"></i>
                    Connect Keplr Wallet
                </button>
                <button type="button" class="btn btn-success d-none" id="investModalProceedBtn">
                    <i data-feather="check-circle" class="icon-inline-sm"></i>
                    Proceed with Investment
                </button>
            </div>
        </div>
    </div>
</div>

<!-- AI Assistant Modal -->
<div class="modal fade" id="aiAssistantModal" tabindex="-1" aria-labelledby="aiAssistantModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content bg-dark text-light border-secondary">
            <div class="modal-header border-secondary">
                <h5 class="modal-title" id="aiAssistantModalLabel">
                    <i data-feather="cpu" class="icon-inline text-secondary"></i>
                    AI Contract Assistant
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="nav flex-column nav-pills" id="contract-steps-tab" role="tablist">
                            <button class="nav-link active" id="step1-tab" data-bs-toggle="pill" data-bs-target="#step1" type="button" role="tab">1. Asset Information</button>
                            <button class="nav-link" id="step2-tab" data-bs-toggle="pill" data-bs-target="#step2" type="button" role="tab">2. IFC Validation</button>
                            <button class="nav-link" id="step3-tab" data-bs-toggle="pill" data-bs-target="#step3" type="button" role="tab">3. Stakeholder Details</button>
                            <button class="nav-link" id="step4-tab" data-bs-toggle="pill" data-bs-target="#step4" type="button" role="tab">4. Contract Terms</button>
                            <button class="nav-link" id="step5-tab" data-bs-toggle="pill" data-bs-target="#step5" type="button" role="tab">5. Keplr Signatures</button>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="tab-content p-3" id="contract-steps-content">
                            <div class="tab-pane fade show active" id="step1" role="tabpanel">
                                <h6 class="mb-3 text-info">Asset Information</h6>
                                <p>Enter the core details about your real estate asset. The AI will auto-populate fields from your IFC file once uploaded.</p>
                                <div class="mb-3">
                                    <label class="form-label">Asset Name</label>
                                    <input type="text" class="form-control bg-dark text-light border-secondary">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Location</label>
                                    <input type="text" class="form-control bg-dark text-light border-secondary">
                                </div>
                            </div>
                            <div class="tab-pane fade" id="step2" role="tabpanel">
                                <h6 class="mb-3 text-info">IFC Validation</h6>
                                <p>Upload your IFC file for analysis. Our AI will validate the building information and calculate the estimated asset value.</p>
                                <div class="mb-3">
                                    <label class="form-label">Upload IFC File</label>
                                    <input type="file" class="form-control bg-dark text-light border-secondary">
                                </div>
                            </div>
                            <div class="tab-pane fade" id="step3" role="tabpanel">
                                <h6 class="mb-3 text-info">Stakeholder Details</h6>
                                <p>Define the stakeholders for this asset. These will be encoded in the smart contract.</p>
                                <div class="mb-3">
                                    <label class="form-label">Stakeholder Wallet Addresses</label>
                                    <textarea class="form-control bg-dark text-light border-secondary" rows="3"></textarea>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="step4" role="tabpanel">
                                <h6 class="mb-3 text-info">Contract Terms</h6>
                                <p>Review and modify the smart contract terms generated by our AI.</p>
                                <div class="mb-3">
                                    <label class="form-label">Token Name & Symbol</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control bg-dark text-light border-secondary" placeholder="Name">
                                        <input type="text" class="form-control bg-dark text-light border-secondary" placeholder="Symbol">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Total Supply</label>
                                    <input type="number" class="form-control bg-dark text-light border-secondary">
                                </div>
                            </div>
                            <div class="tab-pane fade" id="step5" role="tabpanel">
                                <h6 class="mb-3 text-info">Keplr Signatures</h6>
                                <p>Final step: Collect multisig approvals from all stakeholders using Keplr wallet.</p>
                                <div class="alert alert-warning">
                                    <i data-feather="alert-triangle" class="icon-inline-sm"></i>
                                    Remember: NFTs can only be minted after the asset has passed due diligence.
                                </div>
                                <button class="btn btn-info">
                                    <i data-feather="link" class="icon-inline-sm"></i>
                                    Connect Keplr for Signing
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-info" id="getAIAdviceBtn">
                    <i data-feather="cpu" class="icon-inline-sm"></i>
                    Get AI Advice
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Custom Scripts -->
<script src="{{ url_for('static', filename='js/ai-chat-enhanced.js') }}"></script>
<script src="{{ url_for('static', filename='js/bim-viewer.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize AI Chat
        aiChat.init('ai-chat-container');

        // Initialize mini BIM viewer
        bimViewer.init('mini-viewer-container');

        // Initialize asset distribution chart
        const assetCtx = document.getElementById('asset-distribution-chart').getContext('2d');
        const assetChart = new Chart(assetCtx, {
            type: 'doughnut',
            data: {
                labels: ['Verified Assets', 'Unverified Assets'],
                datasets: [{
                    data: [65, 35],
                    backgroundColor: [
                        'rgba(0, 153, 7, 0.7)',    // success
                        'rgba(243, 192, 0, 0.7)',  // warning
                    ],
                    borderColor: 'rgba(255, 255, 255, 0.1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    }
                }
            }
        });

        // Initialize stakeholder chart
        const stakeholderCtx = document.getElementById('stakeholder-chart').getContext('2d');
        const stakeholderChart = new Chart(stakeholderCtx, {
            type: 'doughnut',
            data: {
                labels: ['Institutional Investors', 'Private Investors', 'Developer Equity', 'Reserved Pool'],
                datasets: [{
                    data: [45, 25, 20, 10],
                    backgroundColor: [
                        'rgba(224, 13, 121, 0.7)',  // info
                        'rgba(184, 5, 150, 0.7)',   // secondary
                        'rgba(0, 153, 7, 0.7)',     // success
                        'rgba(243, 192, 0, 0.7)'    // warning
                    ],
                    borderColor: 'rgba(255, 255, 255, 0.1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    }
                }
            }
        });

        // Check wallet connection when investment modal is opened
        document.getElementById('investModal').addEventListener('show.bs.modal', function() {
            // Check if wallet is connected (using localStorage)
            const walletConnected = localStorage.getItem('walletConnected') === 'true';
            const userWalletAddress = localStorage.getItem('userWalletAddress');

            // Update wallet address field if available
            if (walletConnected && userWalletAddress) {
                document.getElementById('walletAddress').value = userWalletAddress;

                // Show the proceed button, hide the connect button
                document.getElementById('investModalConnectBtn').classList.add('d-none');
                document.getElementById('investModalProceedBtn').classList.remove('d-none');
            } else {
                // Show the connect button, hide the proceed button
                document.getElementById('investModalConnectBtn').classList.remove('d-none');
                document.getElementById('investModalProceedBtn').classList.add('d-none');
            }
        });

        // Invest modal wallet connection button
        document.getElementById('investModalConnectBtn').addEventListener('click', function() {
            // Access the main wallet connection function from base.html
            connectKeplrWallet();

            // Close the investment modal
            const investModal = bootstrap.Modal.getInstance(document.getElementById('investModal'));
            if (investModal) {
                investModal.hide();
            }
        });

        // Proceed with investment button
        document.getElementById('investModalProceedBtn').addEventListener('click', function() {
            // Get investment amount
            const amount = document.getElementById('investmentAmount').value;

            if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
                alert('Please enter a valid investment amount.');
                return;
            }

            // Check if SPV/KYC confirmation is checked
            const spvKycChecked = document.getElementById('spvKycCheck').checked;
            if (!spvKycChecked) {
                alert('Please confirm SPV/KYC verification.');
                return;
            }

            // Process investment
            alert(`Processing investment of ${amount} ODIS. Transaction will be signed with your Keplr wallet.`);

            // Close modal after successful transaction
            const investModal = bootstrap.Modal.getInstance(document.getElementById('investModal'));
            if (investModal) {
                investModal.hide();
            }
        });

        // Open AI Assistant modal button
        document.body.addEventListener('click', function(e) {
            if (e.target.matches('[data-ai-assistant]') || e.target.closest('[data-ai-assistant]')) {
                new bootstrap.Modal(document.getElementById('aiAssistantModal')).show();
            }
        });

        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });

        // Update feather icons
        feather.replace();
    });
</script>
{% endblock %}