<!DOCTYPE html>
<html data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Tokenization Platform</title>
    <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .blockchain-status {
            font-size: 0.8rem;
            margin-right: 1rem;
        }
        .blockchain-status i {
            margin-right: 0.25rem;
        }
        .blockchain-status.connected {
            color: var(--bs-success);
        }
        .blockchain-status.disconnected {
            color: var(--bs-danger);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">RE Tokenizer</a>
            <div class="navbar-nav me-auto">
                <a class="nav-link" href="/upload">Upload BIM</a>
                <a class="nav-link" href="/contracts">Contracts</a>
            </div>
            <div class="d-flex align-items-center">
                <div class="blockchain-status disconnected">
                    <i class="bi bi-circle-fill"></i>
                    <span>Odiseo Testnet</span>
                </div>
                <button id="connectWallet" class="btn btn-primary">
                    <i class="bi bi-wallet2"></i> Connect Wallet
                </button>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        {% block content %}{% endblock %}
    </div>

    <!-- Initialize Kepler Wallet -->
    <script type="module" src="https://unpkg.com/ping-widget@latest/dist/ping-widget.js"></script>
    <script src="/static/js/kepler.js"></script>
    <script src="/static/js/main.js"></script>
    <script>
        // Update blockchain status when wallet connects/disconnects
        function updateBlockchainStatus(connected) {
            const statusEl = document.querySelector('.blockchain-status');
            if (connected) {
                statusEl.classList.remove('disconnected');
                statusEl.classList.add('connected');
            } else {
                statusEl.classList.remove('connected');
                statusEl.classList.add('disconnected');
            }
        }

        // Check wallet connection status on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateBlockchainStatus(window.keplerWallet?.isConnected() || false);
        });

        // Update status when wallet connection changes
        window.addEventListener('kepler_wallet_connected', () => updateBlockchainStatus(true));
        window.addEventListener('kepler_wallet_disconnected', () => updateBlockchainStatus(false));
    </script>
</body>
</html>