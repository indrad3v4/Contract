{% extends "base.html" %}

{% block title %}Upload BIM Models - BIM AI Management Dashboard{% endblock %}
{% block page_title %}Upload BIM Models{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    <i data-feather="upload-cloud" class="icon-inline"></i>
                    Upload BIM Models
                </h5>
                <div class="card-subtitle">
                    Import IFC files for tokenization
                </div>
            </div>
            <div class="card-body">
                <div class="upload-area" id="drop-area">
                    <div class="upload-icon">
                        <i data-feather="upload-cloud"></i>
                    </div>
                    <h3 class="upload-title">Drag & Drop Files Here</h3>
                    <p class="upload-subtitle">or click to browse your files</p>
                    <label class="btn btn-outline-info">
                        <input type="file" id="file-input" multiple style="display: none;">
                        Browse Files
                    </label>
                </div>
                
                <div class="file-list">
                    <h5 class="mb-3">Uploaded Files</h5>
                    <div id="uploaded-files">
                        <!-- Sample file item -->
                        <div class="file-item">
                            <div class="file-icon">
                                <i data-feather="file"></i>
                            </div>
                            <div class="file-details">
                                <div class="file-name">Cosmic_Tower_Project.ifc</div>
                                <div class="file-meta">
                                    <span>25.4 MB</span>
                                    <span>•</span>
                                    <span>April 5, 2025</span>
                                </div>
                            </div>
                            <div class="file-actions">
                                <button class="btn btn-sm btn-outline-info">
                                    <i data-feather="eye" class="icon-inline-sm"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger">
                                    <i data-feather="trash-2" class="icon-inline-sm"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-7">
        <!-- Tokenization Configuration -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    <i data-feather="settings" class="icon-inline"></i>
                    Tokenization Configuration
                </h5>
            </div>
            <div class="card-body">
                <form>
                    <div class="mb-3">
                        <label for="tokenName" class="form-label">Token Name</label>
                        <input type="text" class="form-control" id="tokenName" placeholder="Enter token name">
                    </div>
                    
                    <div class="mb-3">
                        <label for="tokenSymbol" class="form-label">Token Symbol</label>
                        <input type="text" class="form-control" id="tokenSymbol" placeholder="Enter token symbol">
                    </div>
                    
                    <div class="mb-3">
                        <label for="totalSupply" class="form-label">Total Supply</label>
                        <input type="number" class="form-control" id="totalSupply" placeholder="Enter total supply">
                    </div>
                    
                    <div class="mb-3">
                        <label for="initialPrice" class="form-label">Initial Token Price (USD)</label>
                        <input type="number" class="form-control" id="initialPrice" placeholder="Enter initial price">
                    </div>
                    
                    <div class="d-flex justify-content-end">
                        <button type="submit" class="btn btn-info">
                            <i data-feather="check" class="icon-inline-sm"></i>
                            Create Tokens
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-5">
        <!-- File Info Panel -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">
                    <i data-feather="info" class="icon-inline"></i>
                    File Information
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-4">
                    <h6 class="mb-2">Supported File Types</h6>
                    <div class="d-flex gap-2">
                        <span class="badge bg-info">IFC</span>
                        <span class="badge bg-info">IFC4</span>
                        <span class="badge bg-info">IFCXML</span>
                        <span class="badge bg-secondary">OBJ</span>
                        <span class="badge bg-secondary">GLTF</span>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="mb-2">File Size Limits</h6>
                    <p class="mb-0">Maximum file size: <strong>100 MB</strong></p>
                </div>
                
                <div>
                    <h6 class="mb-2">Tokenization Process</h6>
                    <ol class="ps-3">
                        <li>Upload IFC building model</li>
                        <li>Configure tokenization parameters</li>
                        <li>Create smart contract on blockchain</li>
                        <li>Generate tokens for property shares</li>
                        <li>Publish to marketplace</li>
                    </ol>
                </div>
            </div>
        </div>
        
        <!-- AI Assistance -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="card-title">
                    <i data-feather="help-circle" class="icon-inline"></i>
                    AI Assistance
                </h5>
            </div>
            <div class="card-body">
                <p>Need help with tokenization? Our AI assistant can analyze your building model and recommend optimal tokenization settings.</p>
                <button class="btn btn-outline-secondary w-100">
                    <i data-feather="message-circle" class="icon-inline-sm"></i>
                    Get AI Recommendations
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        
        // Prevent default behavior
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        // Highlight drop area when item is dragged over it
        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            dropArea.classList.add('border-info');
        }
        
        function unhighlight() {
            dropArea.classList.remove('border-info');
        }
        
        // Handle dropped files
        dropArea.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }
        
        fileInput.addEventListener('change', function() {
            handleFiles(this.files);
        });
        
        function handleFiles(files) {
            // In a real implementation, you would upload these files to the server
            console.log('Files selected:', files);
            
            // For demo purposes, just show the file names
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                console.log('File:', file.name, file.size, file.type);
                
                // You would upload the file here and then add it to the list
                // For now, we'll just simulate adding it to the list
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-icon">
                        <i data-feather="file"></i>
                    </div>
                    <div class="file-details">
                        <div class="file-name">${file.name}</div>
                        <div class="file-meta">
                            <span>${(file.size / (1024 * 1024)).toFixed(2)} MB</span>
                            <span>•</span>
                            <span>Just now</span>
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="btn btn-sm btn-outline-info">
                            <i data-feather="eye" class="icon-inline-sm"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger">
                            <i data-feather="trash-2" class="icon-inline-sm"></i>
                        </button>
                    </div>
                `;
                
                document.getElementById('uploaded-files').appendChild(fileItem);
                feather.replace();
            }
        }
        
        // Update feather icons
        feather.replace();
    });
</script>
{% endblock %}
